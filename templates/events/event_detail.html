{% extends "base.html" %}

{% block title %}{{ event.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-12">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Event Content -->
        <div class="lg:col-span-2 space-y-8 animate-fade-in-left">
            <div class="bg-card/60 backdrop-blur-xl border rounded-xl shadow-lg">
                <img src="{{ event.image.url }}" alt="{{ event.name }}" class="w-full h-80 object-cover rounded-t-xl">
                <div class="p-8">
                    <h1 class="text-4xl font-bold tracking-tighter mb-4">{{ event.name }}</h1>
                    <div class="flex flex-wrap items-center gap-x-4 gap-y-2 mb-6 text-muted-foreground">
                        <span>📅 {{ event.date|date:"l, F d, Y" }} at {{ event.time|time:"g:i A" }}</span>
                        <span>📍 {{ event.location }}</span>
                        {% if event.category %}<span>🏷️ {{ event.category.name }}</span>{% endif %}
                    </div>
                    <div class="prose dark:prose-invert max-w-none text-foreground/80">
                        {{ event.description|linebreaks }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1 space-y-6 animate-fade-in-right animate-delay-200">
            <div class="bg-card/60 backdrop-blur-xl border rounded-xl shadow-lg p-6 space-y-6">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Actions</h3>
                    {% if event.ticket_price > 0 %}
                        <a href="{% url 'event_checkout' event.pk %}" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground shadow hover:bg-primary/90 hover:animate-pulse mb-4">
                            Buy Ticket (${{ event.ticket_price|floatformat:2 }})
                        </a>
                    {% endif %}
                    {% if user.is_authenticated and event.is_upcoming %}
                        <div hx-post="{% url 'rsvp_toggle' event.pk %}" hx-swap="outerHTML">
                            <button class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground hover:animate-pulse">
                                {% if user in event.participants.all %}
                                    ✅ You're attending!
                                {% else %}
                                    📝 RSVP for this event {% if event.ticket_price == 0 %}(Free){% endif %}
                                {% endif %}
                            </button>
                        </div>
                    {% endif %}
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">Organizer</h3>
                    <p class="text-muted-foreground">{{ event.organizer.get_full_name|default:event.organizer.email }}</p>
                </div>

                {% if user.is_authenticated and user.is_superuser or user.is_authenticated and event.organizer == user %}
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Admin Actions</h3>
                        <div class="flex flex-wrap gap-3">
                            <a href="{% url 'event_update' event.pk %}" class="text-sm text-yellow-500 hover:underline hover:scale-105 transition-transform duration-200">Edit Event</a>
                            <a href="{% url 'event_delete' event.pk %}" class="text-sm text-destructive hover:underline hover:scale-105 transition-transform duration-200">Delete Event</a>
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="bg-card/60 backdrop-blur-xl border rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Participants ({{ event.participants.count }})</h3>
                <div class="space-y-3">
                    {% for p in event.participants.all|slice:":5" %}
                        <div class="flex items-center">
                            <span class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm font-medium mr-3 avatar-hover-effect">{{ p.first_name.0|default:p.email.0|upper }}</span>
                            <span class="text-sm text-muted-foreground">{{ p.get_full_name|default:p.email }}</span>
                        </div>
                    {% empty %}
                        <p class="text-sm text-muted-foreground">Be the first to join!</p>
                    {% endfor %}
                    {% if event.participants.count > 5 %}
                        <p class="text-sm text-muted-foreground">+{{ event.participants.count|add:"-5" }} more</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}